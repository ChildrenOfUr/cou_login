<!DOCTYPE html>
<link rel="import" href="../../../packages/polymer/polymer.html">
<link rel="import" href="../../../packages/cou_toolkit/toolkit/toolkit.html">

<polymer-element name="ur-login" attributes="server websocket base">
	<template>
		<link rel="stylesheet" href="login.css">
		<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">

		<ur-panel class="splash" id="user-login">
			<img src="logo.svg" class="logo"><br>

			<template if="{{loggedIn}}">
				<span class="greeting"><span id="greeting-prefix"></span>, {{username}}</span>
			</template>

			<template if="{{!newUser && !forgotPassword && !newSignup && !loggedIn}}">
				<div on-keydown="{{loginAttempt}}" id="loginscreen">
					<div id="top">
						<div id="login">
							<template if="{{waitingOnEmail}}">
								<div id="waiting-warning">
									Please check your email,<br>
									and keep this window open.
								</div>
							</template>
							<input type="email" class="{{waiting?'waiting':''}}" value="{{email}}" placeholder="Email">
							<input type="password" class="{{waiting?'waiting':''}}" value="{{password}}" placeholder="Password">

							<template if="{{passwordConfirmation}}">
								<input id="confirm-password" class="{{waiting?'waiting':''}}" type="password" placeholder="Confirm Password">
							</template>


							<div id="warning"></div>
							<div id="loginsubmit">
								<ur-button id="loginbutton" big="true" class="{{waiting?'waiting':''}}" on-click="{{loginAttempt}}"><i class="fa fa-sign-in"></i> Log In</ur-button>
								<ur-button class="{{waiting?'waiting':''}}" big="true" on-click="{{verifyEmail}}"><i class="fa fa-pencil"></i> Sign Up</ur-button>
							</div>
						</div>
					</div>
					<div id="bottom">
						<div id="social">
							<ur-button id="google" class="{{waiting?'waiting':''}}" theme="light" provider="google" on-click="{{oauthLogin}}"><i class="fa fa-google"></i> Google</ur-button>
							<ur-button id="facebook" class="{{waiting?'waiting':''}}" theme="light" provider="facebook" on-click="{{oauthLogin}}"><i class="fa fa-facebook"></i> Facebook</ur-button>
							<ur-button id="github" class="{{waiting?'waiting':''}}" theme="light" provider="github" on-click="{{oauthLogin}}"><i class="fa fa-github"></i> GitHub</ur-button>
						</div>
					</div>
					<div id="forgot-password" on-click="{{togglePassword}}">Forgot your password?</div>
				</div>
			</template>

			<template if="{{timedout}}">
				<div>
					<span class="greeting">
					Oh no!<br>
					Looks like the server is a bit slow.<br>
					Please check back another time. :(
					</span><br><br>
				</div>
			</template>

			<template if="{{newUser}}">
				<div on-keydown="{{usernameSubmit}}" id="createuser">
					<div class="greeting">Hey, a new face!</div>
					<div>What do you want to be called?</div><br>
					<input id="username" type="text" placeholder="Username (You can change this later)" value="{{newUsername}}" disabled?="{{existingUser}}">
					<ur-button id="createuserbutton" big="true" theme="light" on-click="{{usernameSubmit}}">That's totally me!</ur-button>
				</div>
			</template>

			<template if="{{forgotPassword}}">
				<div id="passwordReset">
					<div class="greeting">Password Reset</div>

					<template if="{{!resetStageTwo}}">
						<div>Enter your email</div>
						<input type="text" placeholder="Email" value="{{email}}">
					</template>

					<template if="{{resetStageTwo}}">
						<div>Get an email?</div>
						<input id="temp-password" type="password" placeholder="Temporary Password">
						<div>Enter your new Password</div>

						<input id="new-password-1" type="password" placeholder="New Password">
						<input id="new-password-2" type="password" placeholder="Confirm New Password">
						<div id="password-warning"></div>
					</template>

					<ur-button id="resetButton" theme="warn" on-click="{{resetPassword}}">Submit</ur-button>
				</div>
				<div id="back-to-main" on-click="{{togglePassword}}">Go back?</div>
			</template>

		</ur-panel>
	</template>
	<script type="application/dart" src="login.dart"></script>
</polymer-element>